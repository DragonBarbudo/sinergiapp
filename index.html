<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>SinergiApp</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">
    <link rel="stylesheet" href="//unpkg.com/vuetify/dist/vuetify.min.css">
    <link rel="stylesheet" href="//unpkg.com/vue-swatches/dist/vue-swatches.min.css">
    <link rel="stylesheet" href="app/app.css">
  </head>
  <body>
    <div id="app">
      <v-app id="inspire">
        <!--:mini-variant.sync="mini" -->
        <v-navigation-drawer v-model="drawer" fixed clipped app width="420">
          <v-toolbar class="blue-grey lighten-3">
            <v-toolbar-title>Configurar documento</v-toolbar-title>
            <v-spacer></v-spacer>
            <v-btn icon @click.stop="drawer = !drawer">
              <v-icon>close</v-icon>
            </v-btn>
          </v-toolbar>
          <v-card class="mb-2">
            <v-toolbar card>
              <v-toolbar-title>Material</v-toolbar-title>
              <v-spacer></v-spacer>
              <v-btn-toggle v-model="material.tipo" mandatory @change="materialSize">
                <v-btn value="flexible" color="red" dark outline><span>Flexible</span>
                  <v-icon>aspect_ratio</v-icon>
                </v-btn>
                <v-btn value="rigido" color="red" dark outline><span>Rígido</span>
                  <v-icon>settings_overscan</v-icon>
                </v-btn>
              </v-btn-toggle>
            </v-toolbar>
            <v-container grid-list-xs fluid>
              <!--FLEXIBLE-->
              <v-layout row wrap v-if="material.tipo=='flexible'">
                <v-flex xs6>
                  <v-select :items="db.flexibles" v-model="material.flexibleElegido" box label="Ancho (cm)" item-text="`${data.item.id}, ${data.item.w}`" dense persistent-hint :hint="`${material.flexibleElegido.t}`" color="red" @change="materialSize">
                    <template slot="selection" slot-scope="data">{{data.item.w}}</template>
                    <template slot="item" slot-scope="data">
                      <v-list-tile-content> 
                        <v-list-tile-title v-html="`${data.item.w} cm`"></v-list-tile-title>
                        <v-list-tile-sub-title v-html="data.item.t"></v-list-tile-sub-title>
                      </v-list-tile-content>
                    </template>
                  </v-select>
                </v-flex>
                <v-flex xs6>
                  <v-text-field v-model="material.hFlexible" label="Alto (cm)" min="5" max="10000" required type="number" box hide-details @input="materialSize" color="red"></v-text-field>
                </v-flex>
              </v-layout>
              <!--RIGIDO-->
              <v-layout class="mb-2" v-if="material.tipo == 'rigido'" align-center justify-center>
                <v-select :items="db.rigidos" v-model="material.rigidoElegido" box label="Ancho x Alto (cm)" item-text="`${data.item.w}, ${data.item.h}`" color="red" @change="materialSize">
                  <template slot="selection" slot-scope="data">{{ data.item.w}} x {{data.item.h}} cm</template>
                  <template slot="item" slot-scope="data">
                    <v-list-tile-content>
                      <v-list-tile-title v-html="`${data.item.w} x ${data.item.h} cm`"></v-list-tile-title>
                    </v-list-tile-content>
                  </template>
                </v-select>
              </v-layout>
            </v-container>
          </v-card>
          <v-card class="mt-2">
            <v-toolbar card>
              <v-toolbar-title>Piezas</v-toolbar-title>
              <v-spacer></v-spacer>
              <v-btn color="red" dark outline small v-on:click="addGraphic">Agregar</v-btn>
            </v-toolbar>
            <v-card-text>
              <v-expansion-panel popout v-model="piezasExpansionPanel" expand>
                <v-expansion-panel-content v-for="(p, index) in piezas" :key="index" ripple>
                  <div slot="header"><i class="v-icon material-icons" :style="'font-size: 16px; color:'+p.c">photo_size_select_actual</i><strong> {{p.w}}x{{p.h}} cms [{{p.q}} piezas]</strong></div>
                  <v-card>
                    <v-container grid-list-xs fluid>
                      <v-layout>
                        <v-flex>
                          <v-text-field v-model="p.w" box type="number" label="Ancho (cm)" min="1" color="red"></v-text-field>
                        </v-flex>
                        <v-flex>
                          <v-tooltip top><span>Invertir</span>
                            <v-btn slot="activator" icon color="red" flat v-on:click="rotateGraphic(index, p.w, p.h)">
                              <v-icon>rotate_90_degrees_ccw</v-icon>
                            </v-btn>
                          </v-tooltip>
                        </v-flex>
                        <v-flex>
                          <v-text-field v-model="p.h" box type="number" label="Alto (cm)" min="1" color="red"></v-text-field>
                        </v-flex>
                      </v-layout>
                      <v-layout>
                        <v-flex>
                          <div class="pt-1 text-md-center">
                            <swatches v-model="p.c" swatch-size="20" spacing-size="2" popover-to="right"></swatches>
                          </div>
                        </v-flex>
                        <v-flex>
                          <v-text-field v-model="p.q" type="number" label="Cantidad" min="1" box append-icon="view_quilt" @click:append="fillout(index)" hint="Click en el icono para autorellenar" color="red darken-4">                   </v-text-field>
                        </v-flex>
                      </v-layout>
                      <v-layout outline v-if="index != 0">
                        <v-flex>
                          <v-btn color="red" small v-on:click="deleteGraphic(index)" outline>Eliminar</v-btn>
                        </v-flex>
                      </v-layout>
                    </v-container>
                  </v-card>
                </v-expansion-panel-content>
              </v-expansion-panel>
            </v-card-text>
          </v-card>
          <v-card class="mt-2">
            <v-toolbar card>
              <v-toolbar-title>Acabados para {{material.tipo}}s</v-toolbar-title>
              <v-spacer></v-spacer>
            </v-toolbar>
            <v-card-text v-if="material.tipo == 'rigido'">
              <v-checkbox :label="'Margen para corte'" v-model="material.margen" color="red"></v-checkbox>
              <v-radio-group label="Medianil: " v-model="material.medianil" mandatory row>
                <v-radio v-for="m in db.medianiles" :label="m.name" :value="m" color="red" :key="m.name"></v-radio>
              </v-radio-group>
            </v-card-text>
            <v-card-text v-if="material.tipo == 'flexible'">
              <v-tooltip top><span>La pinza de 1.5 cm es obligatoria en flexibles</span>
                <v-checkbox :label="'Pinza'" slot="activator" v-model="material.pinza" color="red" disabled></v-checkbox>
              </v-tooltip>
              <v-switch label="Rebase perimetral (Jareta)" v-model="material.rebase" color="red"></v-switch>
              <div v-if="material.rebase">
                <v-layout align-center justify-center>
                  <v-btn-toggle v-model="material.rebaseTipo" mandatory>
                    <v-btn v-for="count in 3" :key="count" color="red" dark outline>
                      <v-icon small :class="'icon-jareta_'+count"></v-icon>
                    </v-btn>
                  </v-btn-toggle>
                </v-layout>
                <v-container>
                  <template v-if="material.rebaseTipo==0">
                    <v-layout>
                      <v-flex>
                        <v-text-field v-model="material.rebases.tb" label="Rebase (cm)" type="number" outline min="0"></v-text-field>
                      </v-flex>
                      <v-flex>&nbsp;</v-flex>
                      <v-flex>&nbsp;</v-flex>
                      <v-flex>
                        <v-text-field v-model="material.rebases.t" label="Superior (cm)" type="number" :append-icon="'border_top'" disabled></v-text-field>
                      </v-flex>
                      <v-flex>&nbsp;</v-flex>
                      <v-flex>
                        <v-text-field v-model="material.rebases.b" label="Inferior (cm)" type="number" :append-icon="'border_bottom'" disabled></v-text-field>
                      </v-flex>
                    </v-layout>
                  </template>
                  <template v-if="material.rebaseTipo==1">
                    <v-layout>
                      <v-flex>
                        <v-text-field v-model="material.rebases.lr" label="Rebase (cm)" type="number" outline min="0"></v-text-field>
                      </v-flex>
                      <v-flex>&nbsp;</v-flex>
                      <v-flex>&nbsp;</v-flex>
                      <v-flex>
                        <v-text-field v-model="material.rebases.l" label="Izquierdo (cm)" type="number" :append-icon="'border_left'" disabled></v-text-field>
                      </v-flex>
                      <v-flex>&nbsp;</v-flex>
                      <v-flex>
                        <v-text-field v-model="material.rebases.r" label="Derecho (cm)" type="number" :append-icon="'border_right'" disabled></v-text-field>
                      </v-flex>
                    </v-layout>
                  </template>
                  <template v-if="material.rebaseTipo==2">
                    <v-layout>
                      <v-flex>
                        <v-text-field v-model="material.rebases.t" label="Superior (cm)" type="number" :append-icon="'border_top'" outline></v-text-field>
                      </v-flex>
                      <v-flex>
                        <v-text-field v-model="material.rebases.b" label="Inferior (cm)" type="number" :append-icon="'border_bottom'" outline></v-text-field>
                      </v-flex>
                    </v-layout>
                    <v-layout>
                      <v-flex>
                        <v-text-field v-model="material.rebases.l" label="Izquierdo (cm)" type="number" :append-icon="'border_left'" outline></v-text-field>
                      </v-flex>
                      <v-flex>
                        <v-text-field v-model="material.rebases.r" label="Derecho (cm)" type="number" :append-icon="'border_right'" outline></v-text-field>
                      </v-flex>
                    </v-layout>
                  </template>
                </v-container>
              </div>
            </v-card-text>
          </v-card>
        </v-navigation-drawer>
        <v-toolbar class="red darken-4" dark dense fixed clipped-left app>
          <v-toolbar-side-icon @click.stop="drawer = !drawer">
            <v-icon class="mx-3">menu</v-icon>
          </v-toolbar-side-icon>
          <v-toolbar-title>Sinergia Publicitaria</v-toolbar-title>
          <v-spacer></v-spacer>
          <v-tooltip bottom><span>Descargar como PDF</span>
            <v-btn v-on:click="downloadPDF" slot="activator" icon>
              <v-icon>picture_as_pdf</v-icon>
            </v-btn>
          </v-tooltip>
        </v-toolbar>
        <v-content>
          <v-container>
            <v-card class="blue-grey lighten-3">
              <v-card-text>
                <div id="visualizer">{{visualizer}}</div>
                <v-tabs dark slider-color="white" color="red darken-4" show-arrows v-model="activePage">
                  <v-tab v-for="(page, index) in paginas" :key="index" ripple>Hoja {{index+1}}</v-tab>
                  <v-tab-item v-for="(page, index) in paginas" :key="index">
                    <div class="svg-container">
                      <div class="mat_w caption">{{material.w}} cm</div>
                      <div class="mat_h caption">{{material.h}} cm</div>
                      <svg class="rendered" :view-box.camel="viewboxSize" :id="'page-'+index">
                        <rect class="elevation-4" :width="material.w" :height="material.h" stroke-width=".1" stroke="#eee" fill="#fff"></rect>
                        <!-- MARGEN-->
                        <g v-if="material.margen &amp;&amp; material.tipo=='rigido'">
                          <rect :width="material.w" height="1" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1"></rect>
                          <rect :width="1" :height="material.h" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1"></rect>
                          <rect :width="material.w" height="1" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1" :transform="'translate(0,'+(material.h-1)+')'"></rect>
                          <rect :width="1" :height="material.h" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1" :transform="'translate('+(material.w-1)+',0)'"></rect>
                        </g>
                        <!-- PINZA-->
                        <g v-if="material.pinza &amp;&amp; material.tipo=='flexible'">
                          <rect :width="material.w" height="1.5" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1"></rect>
                          <rect :width="1.5" :height="material.h" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1"></rect>
                          <rect :width="material.w" height="1.5" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1" :transform="'translate(0,'+(material.h-1)+')'"></rect>
                          <rect :width="1.5" :height="material.h" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1" :transform="'translate('+(material.w-1)+',0)'"></rect>
                        </g>
                        <!--REBASE-->
                        <!--
                        rect(:width="material.w" :height="material.rebases.t" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1").rebase-t
                        rect(:width="material.w" :height="material.rebases.b" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1" :transform="'translate(0,'+(material.h-material.rebases.b)+')'").rebase-b
                        rect(:width="material.rebases.l" :height="material.h" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1").rebase-l
                        rect(:width="material.rebases.r" :height="material.h" stroke-width=".2" stroke="#000" fill="#fff" stroke-dasharray="1,1" :transform="'translate('+(material.w-material.rebases.r)+',0)'").rebase-r
                        
                        
                        -->
                        <!--GRAFICO-->
                        <g v-for="(g, index) in page.graphics" v-bind:transform="'translate('+g.x+','+g.y+')'">
                          <template v-if="material.tipo=='flexible'">
                            <!--Rebases-->
                            <!--T-->
                            <rect :width="g.w" :height="material.rebases.t" fill="rgba(0,0,0,0.2)" stroke-width=".1" stroke="#444" stroke-dasharray="3,3"></rect>
                            <!--B-->
                            <rect :width="g.w" :height="material.rebases.b" fill="rgba(0,0,0,0.2)" :transform="'translate(0,'+(g.h-material.rebases.b)+' )'" stroke-width=".1" stroke="#444" stroke-dasharray="3,3"></rect>
                            <!--L-->
                            <rect :width="material.rebases.l" :height="g.h" fill="rgba(10,10,10,0.1)" stroke-width=".1" stroke="#888" stroke-dasharray="3,3"></rect>
                            <!--R-->
                            <rect :width="material.rebases.r" :height="g.h" fill="rgba(10,10,10,0.1)" :transform="'translate('+(g.w-material.rebases.r)+', 0)'" stroke-width=".1" stroke="#888" stroke-dasharray="3,3"></rect>
                            <rect :width="g.w-material.rebases.l-material.rebases.r" :height="g.h-material.rebases.t-material.rebases.b" fill="rgba(255,255,255,0.1)" stroke-width=".3" v-bind:stroke="g.c" :transform="'translate('+material.rebases.l+','+material.rebases.t+')'"></rect>
                          </template>
                          <template v-if="material.tipo=='rigido'">
                            <rect v-bind:width="g.w" v-bind:height="g.h" fill="rgba(0,0,0,0.1)" stroke-width=".1" stroke="#444" stroke-dasharray="3,3"></rect>
                            <rect v-bind:width="g.w-(material.medianil.value*2)" v-bind:height="g.h-(material.medianil.value*2)" fill="#fff" stroke-width=".3" v-bind:stroke="g.c" :transform="'translate('+material.medianil.value+','+material.medianil.value+')'"></rect>
                          </template>
                        </g>
                      </svg>
                      <v-layout class="resultado">
                        <v-flex>Ocupado: {{page.ocupado}} cm2</v-flex>
                        <v-flex>Merma: {{(material.w_rendered*material.h_rendered)-page.ocupado}} cm2</v-flex>
                      </v-layout>
                    </div>
                  </v-tab-item>
                </v-tabs>
              </v-card-text>
            </v-card>
          </v-container>
        </v-content>
        <v-footer class="red darken-4 pa-3" dark dense tile app>
          <div>Última modificación: 2018-7-24 16:39:36</div>
          <v-spacer></v-spacer>
          <div>Sinergia Publicitaria. {{ new Date().getFullYear() }}.</div>
        </v-footer>
        <v-dialog v-model="changelog" max-width="400">
          <v-card>
            <v-card-title primary-title>
              <h3>Pendientes</h3>
            </v-card-title>
            <v-card-text>
              <ul>
                <li>Botón de descarga.</li>
                <li>Preloader en muchas piezas.</li>
                <li>Mejorar algoritmo de acomodo.</li>
              </ul>
            </v-card-text>
            <v-card-title primary-title>
              <h3>Changelog</h3>
            </v-card-title>
            <v-card-text>
              <ul>
                <li>Flexible: Rebase perimetral corregido. Por pieza.</li>
                <li>Flexible: Pinza añadida.</li>
                <li>Tabs: Al modificar muestra la primer hoja.</li>
                <li>Piezas: Boton para rotar/invertir.</li>
                <li>Piezas: Modificación UI de cantidad.</li>
                <li>Flexibles: El Visualizador se escala para limitar el alto de la página.</li>
                <li>Flexibles y Rigidos: Almacena la última medida ingresada al cambiar tipo de material.</li>
                <li>General: Configuración en slide izquierdo.</li>
                <li>Rigidos: Cambio de UI en tamaños</li>
                <li>Flexibles: Altura Min 5, Max 10'000.</li>
                <li>Flexibles: Anchos fijos.</li>
                <li>General: Se pueden añadir hasta <strong>40 hojas</strong>.</li>
                <li>Responsivo (sin testear en moviles).</li>
                <li>Refactorización 1. </li>
              </ul>
            </v-card-text>
          </v-card>
        </v-dialog>
        <v-dialog v-model="dialog">
          <v-card>
            <v-card-text>
              <v-alert type="error" :value="true" outline>En construcción</v-alert>
            </v-card-text>
          </v-card>
        </v-dialog>
      </v-app>
    </div>
    <script src="//unpkg.com/vue/dist/vue.js"></script>
    <!--script(src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js")-->
    <script src="//unpkg.com/vuetify/dist/vuetify.min.js"></script>
    <script src="//unpkg.com/vue-swatches@1.0.1/dist/vue-swatches.min.js"></script>
    <script src="//cdn.rawgit.com/yWorks/jsPDF/ee8bcea8/dist/jspdf.min.js"></script>
    <script src="//cdn.rawgit.com/yWorks/svg2pdf.js/master/dist/svg2pdf.min.js"></script>
    <script src="app/packer.js"></script>
    <script src="app/config.js"></script>
    <script src="app/app.js"></script>
  </body>
</html>